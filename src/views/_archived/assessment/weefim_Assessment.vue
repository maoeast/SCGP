<!--
  @deprecated
  æ­¤æ–‡ä»¶å·²åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ç»Ÿä¸€çš„è¯„ä¼°å®¹å™¨ AssessmentContainer.vue

  æ–°è·¯ç”±: /assessment/unified/weefim/:studentId
  é©±åŠ¨å™¨: src/strategies/assessment/WeeFIMDriver.ts

  Phase 4 é‡æ„ï¼šè¯„ä¼°æ¨¡å—å·²è¿ç§»åˆ°"UI å®¹å™¨å¤ç”¨ + ç­–ç•¥é©±åŠ¨å™¨"æ¶æ„ã€‚
  æ­¤æ–‡ä»¶ä»…ä½œä¸ºå†å²å‚è€ƒä¿ç•™ï¼Œä¸åº”å†è¢«è·¯ç”±å¼•ç”¨ã€‚

  è¿ç§»æ—¥æœŸ: 2026-02-24
-->
<template>
  <div class="weefim-assessment">
    <!-- æ¸©é¦¨æç¤ºå¯¹è¯æ¡† -->
    <el-dialog
      v-model="showWelcomeDialog"
      title=""
      width="520px"
      append-to-body
      :close-on-click-modal="false"
      :close-on-press-escape="false"
      :show-close="false"
      class="welcome-dialog"
      draggable
    >
      <div class="welcome-content">
        <p class="welcome-intro">æ¬¢è¿å¼€å§‹è¿™æ¬¡å…³äº"ç‹¬ç«‹"çš„æ¢ç´¢ã€‚WeeFIM ä¸ä»…ä»…æ˜¯ä¸€ä¸ªåˆ†æ•°ï¼Œå®ƒæ˜¯ä¸€å¼ å¸®åŠ©æˆ‘ä»¬ç†è§£å­©å­å¦‚ä½•è¿ˆå‘ç‹¬ç«‹çš„åœ°å›¾ã€‚</p>

        <div class="welcome-sections">
          <div class="welcome-section">
            <h4><span class="section-icon">ğŸ¯</span> å…³æ³¨"èƒ½åšä»€ä¹ˆ"ï¼Œè€Œé"ä¸èƒ½åšä»€ä¹ˆ"</h4>
            <p>WeeFIM è¯„ä¼°çš„æ˜¯å­©å­åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­"å®é™…ä¸Šèƒ½åšä»€ä¹ˆ"ï¼Œè€Œä¸æ˜¯"åœ¨ç†æƒ³æ¡ä»¶ä¸‹åº”è¯¥èƒ½åšä»€ä¹ˆ"ã€‚è¯·è®°å½•å­©å­çœŸå®çš„ç‹¬ç«‹è¡¨ç°ã€‚</p>
          </div>

          <div class="welcome-section">
            <h4><span class="section-icon">â±ï¸</span> æ—¶é—´ä¸å®‰å…¨æ˜¯å…³é”®</h4>
            <p>è¯„ä¼°æ—¶è¯·è€ƒè™‘ï¼šå­©å­å®Œæˆè¿™é¡¹æ´»åŠ¨éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿæ˜¯å¦éœ€è¦ä»–äººç›‘ç£æˆ–è¾…åŠ©ï¼Ÿå®‰å…¨å—ï¼Ÿè¿™äº›éƒ½æ˜¯è¡¡é‡ç‹¬ç«‹æ€§çš„é‡è¦æŒ‡æ ‡ã€‚</p>
          </div>

          <div class="welcome-section">
            <h4><span class="section-icon">ğŸ‘ï¸</span> å¸¸è§„ç¯å¢ƒä¸­çš„è¡¨ç°</h4>
            <p>è¯·åŸºäºå­©å­åœ¨å®¶åº­ã€å­¦æ ¡ç­‰æ—¥å¸¸ç¯å¢ƒä¸­çš„å¸¸è§„è¡¨ç°æ¥è¯„ä¼°ï¼Œè€Œéåœ¨æ²»ç–—æˆ–è®­ç»ƒæ—¶çš„ç‰¹æ®Šè¡¨ç°ã€‚</p>
          </div>

          <div class="welcome-section">
            <h4><span class="section-icon">ğŸ”’</span> éšç§ä¿æŠ¤</h4>
            <p>æ‰€æœ‰è¯„ä¼°æ•°æ®å°†ä¸¥æ ¼ä¿å¯†ï¼Œä»…ç”¨äºæ”¯æŒå­©å­çš„æˆé•¿å’Œåˆ¶å®šä¸ªæ€§åŒ–è®­ç»ƒè®¡åˆ’ã€‚</p>
          </div>
        </div>

        <p class="welcome-footer">è®©æˆ‘ä»¬æºæ‰‹ï¼Œå‘ç°å­©å­è¿ˆå‘ç‹¬ç«‹çš„æ¯ä¸€æ­¥ï¼</p>
      </div>
      <template #footer>
        <div class="dialog-footer">
          <el-button type="success" @click="startAssessment">
            æˆ‘å·²äº†è§£ï¼Œå¼€å§‹è¯„ä¼°
          </el-button>
        </div>
      </template>
    </el-dialog>

    <!-- è¯„ä¼°å¤´éƒ¨ -->
    <el-card class="assessment-header">
      <template #header>
        <div class="header-content">
          <div class="student-info">
            <h3>WeeFIMé‡è¡¨è¯„ä¼°</h3>
            <div class="info-row">
              <span>å­¦ç”Ÿï¼š{{ student?.name }}</span>
              <span>å¹´é¾„ï¼š{{ studentAge }}å²</span>
            </div>
          </div>
          <div class="progress-info">
            <el-progress
              :percentage="progressPercentage"
              :format="progressFormat"
              :stroke-width="20"
            />
            <div class="progress-text">
              å·²å®Œæˆï¼š{{ currentIndex + 1 }} / {{ totalQuestions }}
            </div>
          </div>
        </div>
      </template>
    </el-card>

    <!-- é¢˜ç›®å¡ç‰‡ -->
    <el-card class="question-card" v-if="currentQuestion">
      <template #header>
        <div class="question-header">
          <span class="question-number">ç¬¬ {{ currentIndex + 1 }} é¢˜</span>
          <span class="question-category">{{ getCategoryName(currentQuestion.category_id) }}</span>
        </div>
      </template>

      <div class="question-content">
        <div class="question-title">
          {{ currentQuestionIndex }}. {{ currentQuestion.title }}
        </div>

        <!-- è¯„åˆ†æ ‡å‡† -->
        <div class="score-guide" v-if="currentScoringCriteria">
          <h4>è¯„åˆ†æ ‡å‡†ï¼š</h4>
          <div class="scoring-criteria">
            <div
              v-for="criteria in currentScoringCriteria.criteria"
              :key="criteria.score"
              class="criteria-item"
              :class="{ 'selected': currentAnswer === criteria.score }"
              @click="selectScore(criteria.score)"
            >
              <div class="criteria-header">
                <span class="criteria-score">{{ criteria.score }}åˆ†</span>
              </div>
              <div class="criteria-content">
                {{ criteria.description }}
              </div>
            </div>
          </div>
        </div>

        <!-- è¯­éŸ³æ’­æ”¾æŒ‰é’® -->
        <div class="question-actions">
          <el-button
            type="info"
            :icon="Microphone"
            @click="playAudio"
            :loading="isPlaying"
          >
            {{ isPlaying ? 'æ’­æ”¾ä¸­...' : 'æœ—è¯»é¢˜ç›®' }}
          </el-button>
        </div>
      </div>

      <!-- æ“ä½œæŒ‰é’® -->
      <div class="question-footer">
        <el-button
          :disabled="currentIndex === 0"
          @click="previousQuestion"
        >
          ä¸Šä¸€é¢˜
        </el-button>
        <div class="question-info">
          ç¬¬ {{ currentQuestionIndex }} é¢˜ / å…± {{ totalQuestions }} é¢˜
        </div>
      </div>
    </el-card>

    <!-- è¯„ä¼°å®Œæˆå¯¹è¯æ¡† -->
    <el-dialog
      v-model="showCompleteDialog"
      title="è¯„ä¼°å®Œæˆ"
      width="500px"
      append-to-body
      :close-on-click-modal="false"
      :close-on-press-escape="false"
      :show-close="false"
    >
      <div class="complete-content" v-if="assessmentResult">
        <el-icon class="success-icon" color="#67C23A" size="60"><CircleCheck /></el-icon>
        <h3>è¯„ä¼°å·²å®Œæˆï¼</h3>
        <div class="result-summary">
          <div class="result-item">
            <span class="label">æ€»åˆ†ï¼š</span>
            <span class="score">{{ assessmentResult.total_score }}/126</span>
          </div>
          <div class="result-item">
            <span class="label">è¿åŠ¨åŠŸèƒ½ï¼š</span>
            <span class="score">{{ assessmentResult.motor_score }}/91</span>
          </div>
          <div class="result-item">
            <span class="label">è®¤çŸ¥åŠŸèƒ½ï¼š</span>
            <span class="score">{{ assessmentResult.cognitive_score }}/35</span>
          </div>
          <div class="result-item">
            <span class="label">ç‹¬ç«‹æ€§ç­‰çº§ï¼š</span>
            <span class="level" :class="getLevelClass(assessmentResult.level?.level)">
              {{ assessmentResult.level?.level }}
            </span>
          </div>
        </div>
      </div>
      <div class="complete-content" v-else>
        <el-icon class="success-icon" color="#67C23A" size="60"><CircleCheck /></el-icon>
        <h3>è¯„ä¼°å·²å®Œæˆï¼</h3>
        <p>ç³»ç»Ÿæ­£åœ¨è®¡ç®—è¯„ä¼°ç»“æœ...</p>
      </div>
      <template #footer>
        <el-button @click="saveAndExit">ä¿å­˜å¹¶é€€å‡º</el-button>
        <el-button type="primary" @click="viewReport">æŸ¥çœ‹æŠ¥å‘Š</el-button>
      </template>
    </el-dialog>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, onBeforeUnmount } from 'vue'
import { useRouter, useRoute } from 'vue-router'
import { ElMessage, ElMessageBox } from 'element-plus'
import {
  Microphone,
  CircleCheck,
  SuccessFilled
} from '@element-plus/icons-vue'
import { useStudentStore } from '@/stores/student'
import { WeeFIMAPI, ReportAPI } from '@/database/api'
// å“åº”å¼é‡è¡¨æ•°æ®
const weefimQuestions = ref<any[]>([])
const weefimCategories = ref<any[]>([])
const calculateWeeFIMScores = ref<any>(null)

const router = useRouter()
const route = useRoute()
const studentStore = useStudentStore()

// æ¸©é¦¨æç¤ºå¯¹è¯æ¡†
const showWelcomeDialog = ref(true)

// å­¦ç”Ÿä¿¡æ¯
const studentId = ref(route.query.studentId as string)
const student = computed(() =>
  studentStore.students.find(s => s.id === parseInt(studentId.value))
)

// å­¦ç”Ÿå¹´é¾„
const studentAge = computed(() => {
  if (!student.value?.birthday) return 0
  const birth = new Date(student.value.birthday)
  const today = new Date()
  let age = today.getFullYear() - birth.getFullYear()
  const monthDiff = today.getMonth() - birth.getMonth()
  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
    age--
  }
  return age
})

// é¢˜ç›®ç›¸å…³çŠ¶æ€
const currentIndex = ref(0)
const totalQuestions = computed(() => weefimQuestions.value.length)
const currentQuestion = computed(() => weefimQuestions.value[currentIndex.value])
const progressPercentage = computed(() => {
  if (totalQuestions.value === 0) return 0
  return Math.round(((currentIndex.value + 1) / totalQuestions.value) * 100)
})

// ç­”æ¡ˆå­˜å‚¨
const answers = ref<Record<number, number>>({})
const currentAnswer = ref<number | null>(null)

// è¯­éŸ³æ’­æ”¾çŠ¶æ€
const isPlaying = ref(false)
let speechSynthesis: SpeechSynthesis | null = null
let currentUtterance: SpeechSynthesisUtterance | null = null

// å®Œæˆå¯¹è¯æ¡†
const showCompleteDialog = ref(false)
const assessId = ref<number | null>(null)
const assessmentResult = ref<any>(null)

// è¯„åˆ†æ ‡å‡†
const weefimScoringCriteria = ref<any[]>([])
const currentScoringCriteria = computed(() => {
  if (!currentQuestion.value || !weefimScoringCriteria.value.length) return null
  return weefimScoringCriteria.value.find(criteria => criteria.id === currentQuestion.value.id)
})

// é¢˜ç›®ç´¢å¼•ï¼ˆä»1å¼€å§‹ï¼‰
const currentQuestionIndex = computed(() => currentIndex.value + 1)

// è¿›åº¦æ ¼å¼åŒ–
const progressFormat = (percentage: number) => `${percentage}%`

// è·å–ç­‰çº§æ ·å¼ç±»
const getLevelClass = (level: string) => {
  const classMap: Record<string, string> = {
    'å®Œå…¨ç‹¬ç«‹': 'level-complete',
    'åŸºæœ¬ç‹¬ç«‹': 'level-basic',
    'è½»åº¦ä¾èµ–': 'level-mild',
    'ä¸­åº¦ä¾èµ–': 'level-moderate',
    'é‡åº¦ä¾èµ–': 'level-severe',
    'æé‡åº¦ä¾èµ–': 'level-extreme',
    'å®Œå…¨ä¾èµ–': 'level-total'
  }
  return classMap[level] || ''
}

// è·å–åˆ†ç±»åç§°
const getCategoryName = (categoryId: number) => {
  const category = weefimCategories.value.find(c => c.id === categoryId)
  return category ? category.name : ''
}

// è·å–åˆ†æ•°æè¿°
const getScoreDescription = (score: number) => {
  const descriptions: Record<number, string> = {
    7: 'å®Œå…¨ç‹¬ç«‹',
    6: 'åŸºæœ¬ç‹¬ç«‹',
    5: 'éœ€è¦ç›‘ç£',
    4: 'æœ€å°ä¾èµ–',
    3: 'ä¸­åº¦ä¾èµ–',
    2: 'æœ€å¤§ä¾èµ–',
    1: 'å®Œå…¨ä¾èµ–'
  }
  return descriptions[score] || ''
}

// é€‰æ‹©è¯„åˆ†
const selectScore = async (score: number) => {
  currentAnswer.value = score
  if (currentQuestion.value) {
    answers.value[currentQuestion.value.id] = score
    // ä¿å­˜ç­”æ¡ˆåˆ°æœ¬åœ°å­˜å‚¨ï¼ˆæ”¯æŒæ–­ç‚¹ç»­åšï¼‰
    saveProgress()

    // è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€é¢˜
    await nextQuestion()
  }
}

// å¤„ç†ç­”æ¡ˆï¼ˆä¿ç•™å…¼å®¹æ€§ï¼‰
const handleAnswer = (value: number) => {
  selectScore(value)
}

// ä¸Šä¸€é¢˜
const previousQuestion = () => {
  if (currentIndex.value > 0) {
    currentIndex.value--
    // æ¢å¤ä¸Šä¸€é¢˜çš„ç­”æ¡ˆ
    currentAnswer.value = answers.value[currentQuestion.value?.id] || null
  }
}

// ä¸‹ä¸€é¢˜
const nextQuestion = async () => {
  if (currentIndex.value < totalQuestions.value - 1) {
    currentIndex.value++
    currentAnswer.value = answers.value[currentQuestion.value?.id] || null
  } else {
    // å®Œæˆè¯„ä¼°
    await completeAssessment()
  }
}

// æ’­æ”¾è¯­éŸ³
const playAudio = () => {
  if (!currentQuestion.value || !('speechSynthesis' in window)) {
    ElMessage.warning('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³æ’­æ”¾åŠŸèƒ½')
    return
  }

  // åœæ­¢å½“å‰æ’­æ”¾
  if (speechSynthesis && speechSynthesis.speaking) {
    speechSynthesis.cancel()
  }

  speechSynthesis = window.speechSynthesis
  currentUtterance = new SpeechSynthesisUtterance(currentQuestion.value.title)
  currentUtterance.lang = 'zh-CN'
  currentUtterance.rate = 0.9

  currentUtterance.onstart = () => {
    isPlaying.value = true
  }

  currentUtterance.onend = () => {
    isPlaying.value = false
  }

  speechSynthesis.speak(currentUtterance)
}

// å®Œæˆè¯„ä¼°
const completeAssessment = async () => {
  let savedAssessId: number | null = null  // æå‰å£°æ˜å˜é‡

  try {
    // è®¡ç®—è¯„ä¼°ç»“æœ
    const result = calculateWeeFIMScores.value(answers.value)

    // ä¿å­˜è¯„ä¼°ç»“æœ
    const assessData = {
      student_id: parseInt(studentId.value),
      total_score: result.total_score,
      adl_score: result.motor_score,
      cognitive_score: result.cognitive_score,
      level: result.level.level,
      start_time: new Date().toISOString(),
      end_time: new Date().toISOString()
    }

    // è°ƒç”¨APIä¿å­˜è¯„ä¼°ç»“æœ
    try {
      const api = new WeeFIMAPI()
      console.log('æ­£åœ¨ä¿å­˜è¯„ä¼°æ•°æ®:', assessData)
      savedAssessId = await api.createAssessment(assessData)
      console.log('è¯„ä¼°è®°å½•å·²ä¿å­˜ï¼ŒID:', savedAssessId)

      // ä¿å­˜è¯„ä¼°è¯¦æƒ…
      const details = Object.entries(answers.value).map(([questionId, score]) => ({
        assess_id: savedAssessId,
        question_id: parseInt(questionId),
        score: score
      }))
      console.log('æ­£åœ¨ä¿å­˜è¯„ä¼°è¯¦æƒ…:', details)
      await api.saveAssessmentDetails(details)
      console.log('è¯„ä¼°è¯¦æƒ…å·²ä¿å­˜')

      console.log('è¯„ä¼°ç»“æœå·²ä¿å­˜:', assessData)
      console.log('è¯¦ç»†ç»“æœ:', result)
      assessId.value = savedAssessId.toString() // ä½¿ç”¨æ•°æ®åº“ç”Ÿæˆçš„çœŸå®ID

      // ä¿å­˜æŠ¥å‘Šè®°å½•
      try {
        const reportAPI = new ReportAPI()
        const reportTitle = `WeeFIMé‡è¡¨è¯„ä¼°æŠ¥å‘Š_${student.value?.name}_${new Date().toLocaleDateString()}`
        reportAPI.saveReportRecord({
          student_id: parseInt(studentId.value),
          report_type: 'weefim',
          assess_id: savedAssessId,
          title: reportTitle
        })
        console.log('âœ… æŠ¥å‘Šè®°å½•å·²ä¿å­˜')
      } catch (error) {
        console.error('ä¿å­˜æŠ¥å‘Šè®°å½•å¤±è´¥:', error)
        // æŠ¥å‘Šè®°å½•ä¿å­˜å¤±è´¥ä¸å½±å“è¯„ä¼°æµç¨‹
      }
    } catch (error) {
      console.error('ä¿å­˜è¯„ä¼°æ•°æ®å¤±è´¥:', error)
      ElMessage.error('ä¿å­˜è¯„ä¼°æ•°æ®å¤±è´¥')
      throw error
    }

    // ä¿å­˜è¯¦ç»†ç»“æœç”¨äºæ˜¾ç¤º
    assessmentResult.value = result

    showCompleteDialog.value = true
  } catch (error) {
    console.error('å®Œæˆè¯„ä¼°å¤±è´¥:', error)
    ElMessage.error('å®Œæˆè¯„ä¼°å¤±è´¥ï¼Œè¯·é‡è¯•')
  }
}

// ä¿å­˜è¿›åº¦
const saveProgress = () => {
  const progress = {
    studentId: studentId.value,
    currentIndex: currentIndex.value,
    answers: answers.value,
    timestamp: new Date().toISOString()
  }
  localStorage.setItem(`weefim_progress_${studentId.value}`, JSON.stringify(progress))
}

// åŠ è½½è¿›åº¦
const loadProgress = () => {
  const saved = localStorage.getItem(`weefim_progress_${studentId.value}`)
  if (saved) {
    const progress = JSON.parse(saved)
    // æ£€æŸ¥æ˜¯å¦æ˜¯åŒä¸€å¤©çš„è¿›åº¦
    const savedDate = new Date(progress.timestamp)
    const today = new Date()
    if (savedDate.toDateString() === today.toDateString()) {
      currentIndex.value = progress.currentIndex || 0
      answers.value = progress.answers || {}
      currentAnswer.value = answers.value[currentQuestion.value?.id] || null
    }
  }
}

// æ¸…é™¤è¿›åº¦
const clearProgress = () => {
  localStorage.removeItem(`weefim_progress_${studentId.value}`)
}

// ä¿å­˜å¹¶é€€å‡º
const saveAndExit = () => {
  clearProgress()
  router.push('/assessment')
}

// æŸ¥çœ‹æŠ¥å‘Š
const viewReport = () => {
  clearProgress()
  router.push({
    path: '/assessment/weefim/report',
    query: {
      assessId: assessId.value,
      studentId: studentId.value
    }
  })
}

// é¡µé¢ç¦»å¼€å‰ç¡®è®¤
onBeforeUnmount(() => {
  if (speechSynthesis && speechSynthesis.speaking) {
    speechSynthesis.cancel()
  }
})

// å¼€å§‹è¯„ä¼°ï¼ˆå…³é—­æ¸©é¦¨æç¤ºå¯¹è¯æ¡†ï¼‰
const startAssessment = () => {
  showWelcomeDialog.value = false
}

// åˆå§‹åŒ–
onMounted(async () => {
  // åŠ¨æ€å¯¼å…¥é‡è¡¨æ•°æ®
  try {
    // åŠ è½½é‡è¡¨æ•°æ®
    const weefimDataModule = await import('@/database/weefim-data')
    weefimQuestions.value = weefimDataModule.weefimQuestions
    weefimCategories.value = weefimDataModule.weefimCategories
    calculateWeeFIMScores.value = weefimDataModule.calculateWeeFIMScores

    // åŠ è½½è¯„åˆ†æ ‡å‡†
    const weefimScoringModule = await import('@/database/weefim-scoring-criteria')
    weefimScoringCriteria.value = weefimScoringModule.weefimScoringCriteria

    console.log('WeeFIMæ•°æ®åŠ è½½æˆåŠŸ:', {
      questions: weefimQuestions.value.length,
      categories: weefimCategories.value.length,
      scoringCriteria: weefimScoringCriteria.value.length
    })
  } catch (error) {
    console.error('åŠ è½½é‡è¡¨æ•°æ®å¤±è´¥:', error)
    ElMessage.error('åŠ è½½é‡è¡¨æ•°æ®å¤±è´¥')
    router.push('/assessment')
    return
  }

  // è·å–å­¦ç”Ÿä¿¡æ¯
  await studentStore.loadStudents()

  if (!student.value) {
    ElMessage.error('å­¦ç”Ÿä¿¡æ¯ä¸å­˜åœ¨')
    router.push('/assessment')
    return
  }

  // åŠ è½½è¿›åº¦
  loadProgress()

  // æ£€æŸ¥æ˜¯å¦æœ‰é¢˜ç›®
  if (weefimQuestions.value.length === 0) {
    ElMessage.error('WeeFIMè¯„ä¼°é¢˜ç›®åŠ è½½å¤±è´¥')
    router.push('/assessment')
    return
  }
})
</script>

<style scoped>
.weefim-assessment {
  padding: 20px;
  max-width: 900px;
  margin: 0 auto;
}

/* æ¸©é¦¨æç¤ºå¯¹è¯æ¡†æ ·å¼ */
:deep(.welcome-dialog) {
  border-radius: 8px;
}

:deep(.welcome-dialog .el-dialog__header) {
  display: none;
}

:deep(.welcome-dialog .el-dialog__body) {
  padding: 20px 20px 10px;
  max-height: 400px;
  overflow-y: auto;
}

.welcome-content {
  padding: 0;
}

.welcome-intro {
  font-size: 14px;
  color: #606266;
  line-height: 1.6;
  text-align: center;
  margin-bottom: 15px;
  font-weight: 500;
}

.welcome-sections {
  margin-bottom: 15px;
}

.welcome-section {
  margin-bottom: 12px;
  padding: 12px;
  background: #f0f9ff;
  border-radius: 6px;
  border-left: 3px solid #67c23a;
}

.welcome-section h4 {
  margin: 0 0 6px 0;
  font-size: 14px;
  color: #303133;
  display: flex;
  align-items: center;
  gap: 8px;
}

.section-icon {
  font-size: 16px;
}

.welcome-section p {
  margin: 0;
  font-size: 13px;
  color: #606266;
  line-height: 1.5;
  padding-left: 24px;
}

.welcome-footer {
  text-align: center;
  font-size: 13px;
  color: #67c23a;
  font-weight: 500;
  margin: 12px 0 0 0;
}

.dialog-footer {
  text-align: center;
  padding: 5px 20px 15px;
}

:deep(.dialog-footer .el-button) {
  min-width: 140px;
  font-size: 14px;
  padding: 10px 24px;
}

.assessment-header {
  margin-bottom: 20px;
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 30px;
}

.student-info h3 {
  margin: 0 0 10px 0;
  color: #303133;
}

.info-row {
  display: flex;
  gap: 20px;
  color: #606266;
}

.progress-info {
  flex: 1;
  max-width: 300px;
}

.progress-text {
  text-align: center;
  margin-top: 10px;
  color: #606266;
}

.question-card {
  min-height: 600px;
}

.question-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.question-number {
  font-weight: bold;
  color: #303133;
}

.question-category {
  background: #fdf6ec;
  color: #e6a23c;
  padding: 4px 12px;
  border-radius: 4px;
  font-size: 14px;
}

.question-content {
  padding: 20px 0;
}

.question-title {
  font-size: 20px;
  color: #303133;
  line-height: 1.6;
  margin-bottom: 20px;
}

.score-guide {
  background: #f5f7fa;
  padding: 20px;
  border-radius: 4px;
  margin-bottom: 30px;
}

.score-guide h4 {
  margin: 0 0 20px 0;
  color: #303133;
  font-size: 18px;
}

.scoring-criteria {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.criteria-item {
  background: white;
  border: 2px solid #dcdfe6;
  border-radius: 8px;
  padding: 15px 20px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.criteria-item:hover {
  border-color: #409eff;
  box-shadow: 0 2px 8px rgba(64, 158, 255, 0.1);
}

.criteria-item.selected {
  border-color: #409eff;
  background-color: #ecf5ff;
  box-shadow: 0 2px 8px rgba(64, 158, 255, 0.2);
}

.criteria-header {
  display: flex;
  align-items: center;
  margin-bottom: 10px;
}

.criteria-score {
  display: inline-block;
  background: #409eff;
  color: white;
  padding: 4px 12px;
  border-radius: 20px;
  font-weight: bold;
  font-size: 14px;
  min-width: 50px;
  text-align: center;
}

.criteria-content {
  color: #606266;
  font-size: 14px;
  line-height: 1.6;
  text-align: justify;
}

.question-actions {
  margin: 30px 0;
}

.question-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 40px;
  padding-top: 20px;
  border-top: 1px solid #dcdfe6;
}

.question-info {
  color: #606266;
  font-size: 14px;
}

.complete-content {
  text-align: center;
  padding: 20px 0;
}

.success-icon {
  margin-bottom: 20px;
}

.result-summary {
  margin-top: 20px;
  padding: 20px;
  background: #f5f7fa;
  border-radius: 8px;
}

.result-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
}

.result-item .label {
  font-weight: bold;
  color: #606266;
}

.result-item .score {
  font-size: 18px;
  font-weight: bold;
  color: #409eff;
}

.result-item .level {
  padding: 4px 12px;
  border-radius: 20px;
  color: white;
  font-weight: bold;
}

.level-complete {
  background: #67c23a;
}

.level-basic {
  background: #85ce61;
}

.level-mild {
  background: #e6a23c;
}

.level-moderate {
  background: #f56c6c;
}

.level-severe {
  background: #e65d6e;
}

.level-extreme {
  background: #dd6161;
}

.level-total {
  background: #bb3737;
}

.complete-content h3 {
  margin: 0 0 10px 0;
  color: #303133;
}

.complete-content p {
  margin: 0;
  color: #606266;
}
</style>